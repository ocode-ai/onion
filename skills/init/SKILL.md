---
name: init
description: Initialize Onion Framework in a project. Sets up task manager, language preferences, git workflow, and integrations. Creates .onion/ config directory.
---

# Onion Project Initialization

You are the Onion Framework setup assistant. Your job is to interactively configure a new project for the Onion workflow system by gathering preferences and creating the `.onion/` configuration directory.

## Step 1: Check Existing Configuration

Before starting, check if `.onion/config.yaml` already exists:

```bash
test -d .onion && echo "EXISTS" || echo "NEW"
```

- If `.onion/` exists, warn the user: "This project already has an Onion configuration. Re-running init will overwrite it. Continue?"
- If the user declines, stop.

## Step 2: Gather Project Preferences

Ask the user the following questions using `AskUserQuestion`. Ask all four at once to minimize back-and-forth:

### Question 1: Task Manager Provider
- **Question**: "Which task manager does your team use?"
- **Options**:
  - **ClickUp** — Full integration via MCP (recommended)
  - **Asana** — Task sync via API
  - **Linear** — Issue tracking via API
  - **None** — Offline mode, local task tracking only

### Question 2: Primary Language
- **Question**: "What is the primary language of this project?"
- **Options**:
  - **TypeScript** — Node.js/Deno/Bun with TypeScript
  - **Python** — Python 3.x
  - **Go** — Go modules
  - **Other** — (user specifies)

### Question 3: Git Workflow
- **Question**: "Which git workflow does your team follow?"
- **Options**:
  - **GitFlow** — feature/release/hotfix branches (recommended for teams)
  - **GitHub Flow** — simple feature branch + PR to main
  - **Trunk-based** — short-lived branches, frequent merges to main

### Question 4: Integrations
- **Question**: "Which additional integrations do you want to enable?"
- **multiSelect**: true
- **Options**:
  - **Gamma** — Presentation generation via Gamma.app API
  - **Code Review** — Automated code review via ChatGPT-CodeReview
  - **DB Schema Visualizer** — ERD generation from Prisma/TypeORM/SQL
  - **Codebase Visualizer** — Interactive project tree visualization

## Step 3: Create Configuration Files

Based on the answers, create the following files:

### .onion/config.yaml

```yaml
# Onion Framework Configuration
# Generated by /onion:init
# Documentation: https://github.com/onion-ai/onion

project:
  language: <answer_2>
  git_workflow: <answer_3>

task_manager:
  provider: <answer_1_lowercase>  # clickup | asana | linear | none

integrations:
  gamma: <true if selected>
  code_review: <true if selected>
  db_schema_visualizer: <true if selected>
  codebase_visualizer: <true if selected>
```

### .onion/.env.example

```env
# ═══════════════════════════════════════
# Onion Framework - Environment Variables
# ═══════════════════════════════════════
# Copy this file to .onion/.env and fill in your values.
# NEVER commit .onion/.env to version control.

# ── Task Manager ──────────────────────
TASK_MANAGER_PROVIDER=<provider>

# ClickUp (if provider=clickup)
# CLICKUP_API_TOKEN=pk_xxxxxxx
# CLICKUP_WORKSPACE_ID=
# CLICKUP_DEFAULT_LIST_ID=

# Asana (if provider=asana)
# ASANA_ACCESS_TOKEN=1/xxxxx
# ASANA_WORKSPACE_ID=
# ASANA_DEFAULT_PROJECT_ID=

# Linear (if provider=linear)
# LINEAR_API_KEY=lin_api_xxxxx
# LINEAR_TEAM_ID=

# ── Integrations ──────────────────────
# GAMMA_API_KEY=gm_xxxxxxxx
```

### .onion/.env

Create a copy of `.env.example` with `TASK_MANAGER_PROVIDER` filled in. Uncomment the section matching the chosen provider.

## Step 4: Patch .gitignore

Ensure these entries exist in the project root `.gitignore`:

```
.onion/.env
```

Read the existing `.gitignore` first. Only append if the entry is missing. Do not duplicate existing entries.

## Step 5: Create CLAUDE.md Entry (if needed)

If the project does NOT already have a `CLAUDE.md` file, create a minimal one:

```markdown
# Project Configuration

This project uses the Onion Framework plugin for Claude Code.

## Environment

- Load environment from `.onion/.env` when available
```

If `CLAUDE.md` already exists, do NOT modify it.

## Step 6: Summary

Present a summary of what was created:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  Onion Framework Initialized
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  Created:
  .onion/config.yaml      Project configuration
  .onion/.env.example      Environment template
  .onion/.env              Local environment (gitignored)
  .gitignore               Updated with .onion/.env

  Configuration:
  Task Manager:   <provider>
  Language:       <language>
  Git Workflow:   <workflow>
  Integrations:   <list or "none">

  Next Steps:
  1. Add your API tokens to .onion/.env
     Run /onion:meta:setup-integration for guided setup
  2. Start a feature with /onion:engineer:start
  3. Explore commands with /onion:onion

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```
